<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-3ET8RHT72W"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-3ET8RHT72W');
    </script>
    <!-- Microsoft Clarity -->
    <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "vnp7z720cj");
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ëŠ” ê°•ì•„ì§€ìƒ? ê³ ì–‘ì´ìƒ? ğŸ¶ğŸ±</title>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6141837364104230" crossorigin="anonymous"></script>
    <style>
        :root {
            --bg: #f7f3ee;
            --card: #ffffff;
            --text: #333333;
            --sub: #888888;
            --border: #eeeeee;
            --shadow: 0 6px 24px rgba(0,0,0,0.09);
            --accent: #ff6b35;
            --accent-hover: #e85a27;
            --dog: #f59e0b;
            --cat: #8b5cf6;
        }
        body.dark {
            --bg: #1a1a2e;
            --card: #16213e;
            --text: #e0e0e0;
            --sub: #aaaaaa;
            --border: #2d3a55;
            --shadow: 0 6px 24px rgba(0,0,0,0.4);
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Apple SD Gothic Neo', 'Malgun Gothic', Arial, sans-serif;
            background: var(--bg);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 40px 16px;
            transition: background 0.3s;
        }

        #theme-toggle {
            position: fixed;
            top: 20px; right: 20px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 50%;
            width: 44px; height: 44px;
            font-size: 1.3em;
            cursor: pointer;
            box-shadow: var(--shadow);
            display: flex; align-items: center; justify-content: center;
            z-index: 100;
            transition: background 0.3s;
        }

        .card {
            background: var(--card);
            border-radius: 20px;
            box-shadow: var(--shadow);
            padding: 36px 32px;
            width: 100%;
            max-width: 480px;
            transition: background 0.3s, box-shadow 0.3s;
        }

        .header { text-align: center; margin-bottom: 28px; }
        .header h1 { font-size: 1.7em; color: var(--text); margin-bottom: 8px; }
        .header p  { font-size: 0.9em; color: var(--sub); }

        /* ì—…ë¡œë“œ ì˜ì—­ */
        .upload-area {
            border: 2px dashed var(--border);
            border-radius: 14px;
            padding: 32px 16px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.2s, background 0.2s;
            margin-bottom: 16px;
            position: relative;
        }
        .upload-area:hover { border-color: var(--accent); background: rgba(255,107,53,0.04); }
        .upload-area.dragover { border-color: var(--accent); background: rgba(255,107,53,0.08); }
        .upload-area input[type=file] {
            position: absolute; inset: 0; opacity: 0; cursor: pointer; width: 100%; height: 100%;
        }
        .upload-icon { font-size: 2.8em; margin-bottom: 10px; }
        .upload-area p { color: var(--sub); font-size: 0.9em; }
        .upload-area strong { color: var(--accent); }

        /* ë¯¸ë¦¬ë³´ê¸° */
        #preview-wrap { display: none; text-align: center; margin-bottom: 16px; }
        #preview-img {
            width: 200px; height: 200px;
            object-fit: cover;
            border-radius: 50%;
            border: 3px solid var(--accent);
            box-shadow: 0 4px 16px rgba(255,107,53,0.2);
        }
        #change-btn {
            display: block;
            margin: 10px auto 0;
            background: none;
            border: none;
            color: var(--accent);
            font-size: 0.85em;
            cursor: pointer;
            text-decoration: underline;
        }

        /* ë¶„ì„ ë²„íŠ¼ */
        #analyze-btn {
            width: 100%;
            background: var(--accent);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 12px;
            font-size: 1.05em;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s, transform 0.1s, opacity 0.2s;
            display: none;
        }
        #analyze-btn:hover { background: var(--accent-hover); }
        #analyze-btn:active { transform: scale(0.98); }
        #analyze-btn:disabled { opacity: 0.6; cursor: not-allowed; }

        /* ë¡œë”© */
        #loading { display: none; text-align: center; padding: 20px 0; }
        .spinner {
            width: 48px; height: 48px;
            border: 4px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin: 0 auto 12px;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        #loading p { color: var(--sub); font-size: 0.9em; }

        /* ê²°ê³¼ */
        #result { display: none; text-align: center; }
        .result-emoji { font-size: 5em; margin-bottom: 8px; animation: pop 0.4s ease; }
        @keyframes pop { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        .result-label {
            font-size: 1.6em;
            font-weight: bold;
            color: var(--text);
            margin-bottom: 4px;
        }
        .result-sub { color: var(--sub); font-size: 0.9em; margin-bottom: 24px; }

        .bars { display: flex; flex-direction: column; gap: 12px; margin-bottom: 24px; }
        .bar-item {}
        .bar-header {
            display: flex;
            justify-content: space-between;
            font-size: 0.85em;
            font-weight: bold;
            color: var(--text);
            margin-bottom: 5px;
        }
        .bar-track {
            background: var(--border);
            border-radius: 99px;
            height: 10px;
            overflow: hidden;
        }
        .bar-fill {
            height: 100%;
            border-radius: 99px;
            transition: width 0.8s cubic-bezier(0.25, 1, 0.5, 1);
        }
        .bar-dog  { background: var(--dog); }
        .bar-cat  { background: var(--cat); }

        #retry-btn {
            width: 100%;
            background: none;
            border: 2px solid var(--accent);
            color: var(--accent);
            padding: 12px;
            border-radius: 12px;
            font-size: 0.95em;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
        }
        #retry-btn:hover { background: var(--accent); color: white; }

        /* ì›¹ìº  ëª¨ë“œ íƒ­ */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
        }
        .tab-btn {
            flex: 1;
            padding: 9px;
            border-radius: 10px;
            border: 1px solid var(--border);
            background: var(--bg);
            color: var(--sub);
            font-size: 0.85em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        .tab-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        /* ì›¹ìº  */
        #webcam-section { display: none; text-align: center; }
        #webcam-container canvas {
            border-radius: 50%;
            border: 3px solid var(--accent);
            width: 200px !important;
            height: 200px !important;
            object-fit: cover;
            margin-bottom: 14px;
        }
        #webcam-analyze-btn {
            width: 100%;
            background: var(--accent);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 12px;
            font-size: 1.05em;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 8px;
        }
        #webcam-analyze-btn:hover { background: var(--accent-hover); }

        #webcam-status { color: var(--sub); font-size: 0.85em; margin-bottom: 8px; }
    </style>
</head>
<body>
    <button id="theme-toggle">ğŸŒ™</button>

    <div class="card">
        <div class="header">
            <h1>ğŸ¶ ë‚˜ëŠ” ê°•ì•„ì§€ìƒ? ê³ ì–‘ì´ìƒ? ğŸ±</h1>
            <p>ì‚¬ì§„ì„ ì˜¬ë¦¬ë©´ AIê°€ ë¶„ì„í•´ë“œë ¤ìš”!</p>
        </div>

        <!-- íƒ­ -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="upload">ğŸ“ ì‚¬ì§„ ì—…ë¡œë“œ</button>
            <button class="tab-btn" data-tab="webcam">ğŸ“· ì›¹ìº </button>
        </div>

        <!-- ì—…ë¡œë“œ íƒ­ -->
        <div id="upload-section">
            <div class="upload-area" id="upload-area">
                <input type="file" id="file-input" accept="image/*">
                <div class="upload-icon">ğŸ–¼ï¸</div>
                <p><strong>í´ë¦­</strong>í•˜ê±°ë‚˜ ì‚¬ì§„ì„ ëŒì–´ë‹¤ ë†“ìœ¼ì„¸ìš”</p>
                <p style="margin-top:6px;font-size:0.8em;">JPG, PNG, WEBP ì§€ì›</p>
            </div>

            <div id="preview-wrap">
                <img id="preview-img" src="" alt="ë¯¸ë¦¬ë³´ê¸°">
                <button id="change-btn">ë‹¤ë¥¸ ì‚¬ì§„ ì„ íƒ</button>
            </div>

            <button id="analyze-btn">ğŸ” ë¶„ì„í•˜ê¸°</button>
        </div>

        <!-- ì›¹ìº  íƒ­ -->
        <div id="webcam-section">
            <p id="webcam-status">ë²„íŠ¼ì„ ëˆŒëŸ¬ ì›¹ìº ì„ ì‹œì‘í•˜ì„¸ìš”.</p>
            <div id="webcam-container"></div>
            <button id="webcam-start-btn" style="width:100%;background:var(--accent);color:white;border:none;padding:14px;border-radius:12px;font-size:1.05em;font-weight:bold;cursor:pointer;margin-bottom:8px;">ğŸ“· ì›¹ìº  ì‹œì‘</button>
            <button id="webcam-analyze-btn" style="display:none;">ğŸ” ì§€ê¸ˆ ë¶„ì„í•˜ê¸°</button>
        </div>

        <!-- ë¡œë”© -->
        <div id="loading">
            <div class="spinner"></div>
            <p>AIê°€ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</p>
        </div>

        <!-- ê²°ê³¼ -->
        <div id="result">
            <div class="result-emoji" id="result-emoji"></div>
            <div class="result-label" id="result-label"></div>
            <div class="result-sub" id="result-sub"></div>
            <div class="bars">
                <div class="bar-item">
                    <div class="bar-header">
                        <span>ğŸ¶ ê°•ì•„ì§€ìƒ</span>
                        <span id="dog-pct">0%</span>
                    </div>
                    <div class="bar-track">
                        <div class="bar-fill bar-dog" id="dog-bar" style="width:0%"></div>
                    </div>
                </div>
                <div class="bar-item">
                    <div class="bar-header">
                        <span>ğŸ± ê³ ì–‘ì´ìƒ</span>
                        <span id="cat-pct">0%</span>
                    </div>
                    <div class="bar-track">
                        <div class="bar-fill bar-cat" id="cat-bar" style="width:0%"></div>
                    </div>
                </div>
            </div>
            <button id="retry-btn">ğŸ”„ ë‹¤ì‹œ í…ŒìŠ¤íŠ¸í•˜ê¸°</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <script>
        const MODEL_URL = 'https://teachablemachine.withgoogle.com/models/HZF_N7aUX/';
        // Class 1 = ê°•ì•„ì§€, Class 2 = ê³ ì–‘ì´
        const CLASS_MAP = {
            'Class 1': 'dog',
            'Class 2': 'cat',
        };
        const ANIMAL = {
            dog: { emoji: 'ğŸ¶', label: 'ê°•ì•„ì§€ìƒ!', subs: ['ìˆœí•˜ê³  ì¹œê·¼í•œ ë§¤ë ¥ì´ ë„˜ì³ìš” ğŸ¾', 'ì¶©ì„±ìŠ¤ëŸ½ê³  ë”°ëœ»í•œ ì¸ìƒì´ì—ìš”!', 'ëˆ„êµ¬ì—ê²Œë‚˜ ì‚¬ë‘ë°›ëŠ” ìŠ¤íƒ€ì¼!'] },
            cat: { emoji: 'ğŸ±', label: 'ê³ ì–‘ì´ìƒ!', subs: ['ì‹ ë¹„ë¡­ê³  ë„ë„í•œ ë§¤ë ¥ì´ ìˆì–´ìš” âœ¨', 'ë…ë¦½ì ì´ê³  ì„¸ë ¨ëœ ë¶„ìœ„ê¸°!', 'ì°¨ê°‘ì§€ë§Œ ë°˜í•˜ê²Œ ë˜ëŠ” íƒ€ì…!'] },
        };

        let model = null;
        let webcam = null;
        let capturedCanvas = null;

        // ëª¨ë¸ ë¯¸ë¦¬ ë¡œë“œ
        async function loadModel() {
            model = await tmImage.load(MODEL_URL + 'model.json', MODEL_URL + 'metadata.json');
        }
        loadModel();

        // ë‹¤í¬ëª¨ë“œ
        const themeToggle = document.getElementById('theme-toggle');
        const saved = localStorage.getItem('theme');
        if (saved === 'dark' || (!saved && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.body.classList.add('dark');
            themeToggle.textContent = 'â˜€ï¸';
        }
        themeToggle.addEventListener('click', () => {
            document.body.classList.toggle('dark');
            const isDark = document.body.classList.contains('dark');
            themeToggle.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        });

        // íƒ­ ì „í™˜
        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                const tab = btn.dataset.tab;
                document.getElementById('upload-section').style.display = tab === 'upload' ? 'block' : 'none';
                document.getElementById('webcam-section').style.display = tab === 'webcam' ? 'block' : 'none';
                hideResult();
            });
        });

        // â”€â”€ ì—…ë¡œë“œ íƒ­ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const fileInput   = document.getElementById('file-input');
        const uploadArea  = document.getElementById('upload-area');
        const previewWrap = document.getElementById('preview-wrap');
        const previewImg  = document.getElementById('preview-img');
        const analyzeBtn  = document.getElementById('analyze-btn');
        const changeBtn   = document.getElementById('change-btn');

        uploadArea.addEventListener('dragover', e => { e.preventDefault(); uploadArea.classList.add('dragover'); });
        uploadArea.addEventListener('dragleave', () => uploadArea.classList.remove('dragover'));
        uploadArea.addEventListener('drop', e => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) loadPreview(file);
        });
        fileInput.addEventListener('change', () => { if (fileInput.files[0]) loadPreview(fileInput.files[0]); });

        function loadPreview(file) {
            const reader = new FileReader();
            reader.onload = e => {
                previewImg.src = e.target.result;
                uploadArea.style.display = 'none';
                previewWrap.style.display = 'block';
                analyzeBtn.style.display  = 'block';
                hideResult();
            };
            reader.readAsDataURL(file);
        }

        changeBtn.addEventListener('click', () => {
            fileInput.value = '';
            uploadArea.style.display = 'block';
            previewWrap.style.display = 'none';
            analyzeBtn.style.display  = 'none';
            hideResult();
        });

        analyzeBtn.addEventListener('click', async () => {
            await runPrediction(previewImg);
        });

        // â”€â”€ ì›¹ìº  íƒ­ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        const webcamStartBtn   = document.getElementById('webcam-start-btn');
        const webcamAnalyzeBtn = document.getElementById('webcam-analyze-btn');
        const webcamContainer  = document.getElementById('webcam-container');
        const webcamStatus     = document.getElementById('webcam-status');

        webcamStartBtn.addEventListener('click', async () => {
            webcamStatus.textContent = 'ì›¹ìº  ì—°ê²° ì¤‘...';
            webcamStartBtn.disabled = true;
            try {
                webcam = new tmImage.Webcam(200, 200, true);
                await webcam.setup();
                await webcam.play();
                webcamContainer.innerHTML = '';
                webcamContainer.appendChild(webcam.canvas);
                webcamStatus.textContent = 'ì›¹ìº ì´ ì¼œì¡Œì–´ìš”. ì–¼êµ´ì„ ë§ì¶”ê³  ë¶„ì„ì„ ëˆŒëŸ¬ë³´ì„¸ìš”!';
                webcamStartBtn.style.display = 'none';
                webcamAnalyzeBtn.style.display = 'block';
                (function loop() { webcam.update(); requestAnimationFrame(loop); })();
            } catch {
                webcamStatus.textContent = 'ì›¹ìº  ì ‘ê·¼ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                webcamStartBtn.disabled = false;
            }
        });

        webcamAnalyzeBtn.addEventListener('click', async () => {
            if (!webcam) return;
            // í˜„ì¬ í”„ë ˆì„ ìº¡ì²˜
            const canvas = document.createElement('canvas');
            canvas.width = 200; canvas.height = 200;
            canvas.getContext('2d').drawImage(webcam.canvas, 0, 0);
            await runPrediction(canvas);
        });

        // â”€â”€ ê³µí†µ ì˜ˆì¸¡ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        async function runPrediction(source) {
            if (!model) {
                alert('ëª¨ë¸ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                return;
            }
            showLoading(true);

            try {
                const predictions = await model.predict(source);
                showLoading(false);
                showResult(predictions);
            } catch (e) {
                showLoading(false);
                alert('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                console.error(e);
            }
        }

        function showLoading(on) {
            document.getElementById('loading').style.display = on ? 'block' : 'none';
            document.getElementById('upload-section').style.opacity = on ? '0.4' : '1';
            if (analyzeBtn) analyzeBtn.disabled = on;
        }

        function showResult(predictions) {
            // Class 1 = dog, Class 2 = cat
            let dogProb = 0, catProb = 0;
            predictions.forEach(p => {
                const type = CLASS_MAP[p.className];
                if (type === 'dog') dogProb = p.probability;
                else if (type === 'cat') catProb = p.probability;
            });

            const winner = dogProb >= catProb ? 'dog' : 'cat';
            const info = ANIMAL[winner];
            const sub = info.subs[Math.floor(Math.random() * info.subs.length)];

            document.getElementById('result-emoji').textContent = info.emoji;
            document.getElementById('result-label').textContent = info.label;
            document.getElementById('result-sub').textContent   = sub;

            const dogPct = Math.round(dogProb * 100);
            const catPct = Math.round(catProb * 100);
            document.getElementById('dog-pct').textContent = dogPct + '%';
            document.getElementById('cat-pct').textContent = catPct + '%';

            // ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•´ 0 â†’ ì‹¤ì œê°’
            setTimeout(() => {
                document.getElementById('dog-bar').style.width = dogPct + '%';
                document.getElementById('cat-bar').style.width = catPct + '%';
            }, 50);

            document.getElementById('result').style.display = 'block';
            document.getElementById('result').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function hideResult() {
            document.getElementById('result').style.display = 'none';
            document.getElementById('dog-bar').style.width = '0%';
            document.getElementById('cat-bar').style.width = '0%';
        }

        document.getElementById('retry-btn').addEventListener('click', () => {
            hideResult();
            fileInput.value = '';
            uploadArea.style.display = 'block';
            previewWrap.style.display = 'none';
            analyzeBtn.style.display  = 'none';
        });
    </script>
</body>
</html>
